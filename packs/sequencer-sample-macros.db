{"name":"Sequencer-Spell-5e-Generic-Magic-Effect","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/symbols/runes-triangle-blue.webp","scope":"global","command":"// Requires the ____PAID____ JB2A module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\n// You can also run this directly on a selected token, or if you have targets, you can run it on them\n\nlet error = false;\nif(!game.modules.get(\"jb2a_patreon\")){\n    error = `You need to have the full (patreon) version of JB2A installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = args[0].targets;\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else{\n\t\tif(token) targets.push(token);\n\t}\n}\n\nlet sequence = new Sequence()\nfor(let target of targets){\n    sequence.effect()\n        .file(\"jb2a.explosion.05\")\n        .atLocation(target)\n        .scale(0.3)\n        .randomRotation()\n}\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.zW1mk5Uk00qebTRz"}},"_id":"785pDKOe1wZAVWIu"}
{"name":"Sequencer-Chains","type":"script","author":"sW3E9DC6Z4EcEfdv","img":"icons/tools/fasteners/chain-steel-blue.webp","scope":"global","command":"const source = canvas.tokens.controlled[0];\n\nif(!source){\n    ui.notifications.error(\"You need to select a token for the chain to start on!\");\n    return;\n}\n\nconst target = Array.from(game.user.targets)?.[0]\n\nif(!target){\n    ui.notifications.error(\"You need to target a token for the chain to end on!\");\n    return;\n}\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/sequencer/samples/Bindings/chain.png\")\n        .attachTo(source)\n        .stretchTo(target, { attachTo: true })\n        .template({ gridSize: 200 })\n        .tilingTexture()\n        .scale(0.5)\n        .belowTokens()\n        .persist()\n    .play()","folder":null,"sort":0,"permission":{"default":0,"sW3E9DC6Z4EcEfdv":3},"flags":{"core":{"sourceId":"Macro.swHtsdLC8SMMg5nZ"}},"_id":"CdY9Tapj5qeBKjJO"}
{"name":"Sequencer-Spell-5e-Generic-Healing","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/life/heart-cross-strong-green.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\n// You can also run this directly on a selected token, or if you have targets, you can run it on them\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = args[0].targets;\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else{\n\t\tif(token) targets.push(token);\n\t}\n}\n\nlet sequence = new Sequence()\nfor(let target of targets){\n    sequence.effect()\n        .atLocation(target)\n        .file(\"jb2a.healing_generic.200px.green\")\n}\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.rTXQknjILCNabjxF"}},"_id":"KGNr5PJVPwV7a50L"}
{"name":"Sequencer-VFX-Chain-Lightning-Simple","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/lightning/bolt-strike-sparks-teal.webp","scope":"global","command":"// Requires the JB2A module (free or patreon)\n// Select a token, then target a set of tokens, and run this macro\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\")?.active || game.modules.get(\"JB2A_DnD5e\")?.active)){\n    error = `You need to have JB2A installed and activated to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet current_target = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nif(targets.indexOf(current_target) > -1){\n    targets = targets.filter(t => t !== current_target);\n}\n\nlet origin = current_target;\nlet [firstTarget] = targets.splice(0, 1); // This removes the first target from the list, and makes it the first target\n\nlet sequence = new Sequence(); // Create a new sequence\n\nsequence.effect()\n    .file(\"jb2a.chain_lightning.primary.blue\")\n    .atLocation(origin) // Going from origin\n    .stretchTo(firstTarget) // To the current loop's target\n    .wait(600)\n\n// then it jumps from the first target, to the next target, and so on\norigin = firstTarget;\n\nfor(let target of targets){\n    sequence.effect()\n        .file(\"jb2a.chain_lightning.secondary.blue\")\n        .atLocation(origin) // Going from origin\n        .stretchTo(target) // To the current loop's target\n    .effect()\n        .file(\"jb2a.static_electricity.02.blue02\")\n        .atLocation(target) // Static on the target\n        .scaleToObject(1.5) // Scale so it fits the target\n        .randomRotation() // Randomly rotate the effect so it's not the same for each token\n    .wait(200) // Slight delay between each arc\n\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.8SJxOa7Y4naxAAP1"}},"_id":"Kd5RVey2DdacMczP"}
{"name":"Sequencer-Spell-5e-Misty-Step","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/control/debuff-energy-snare-purple-blue.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Then add this macro's name to the bottom of the Misty Step spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(!game.modules.get(\"warpgate\")?.active){\n    let installed = game.modules.get(\"warpgate\") && !game.modules.get(\"warpgate\").active ? \"enabled\" : \"installed\";\n    error = `You need to have WarpGate ${installed} to run this macro!`;\n}\n\nconst tokenD = typeof args !== \"undefined\" && args.length !== 0 ? canvas.tokens.get(args?.[0]?.tokenId) : token;\n\nif(!tokenD){\n    error = `Could not find the token to teleport!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet range = await canvas.scene.createEmbeddedDocuments('MeasuredTemplate', [{\n    t: \"circle\",\n    user: game.user._id,\n    x: tokenD.x + canvas.grid.size / 2,\n    y: tokenD.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 30,\n    borderColor: \"#FF0000\"\n}]);\n\nlet position = await warpgate.crosshairs.show({\n    size: 1,\n    tag: randomID(),\n    label: \"Teleport to\",\n    drawOutline: false,\n    drawIcon: false\n}, { show: async (crosshair) => {\n\n    new Sequence()\n        .effect()\n            .from(tokenD)\n            .attachTo(crosshair)\n            .persist()\n            .opacity(0.5)\n        .play();\n\n}})\n\nawait range[0].delete();\n\nnew Sequence()\n    .effect()\n        .file(\"jb2a.misty_step.01.blue\")\n        .atLocation(tokenD)\n        .randomRotation()\n        .scaleToObject(2)\n    .wait(750)\n    .animation()\n        .on(tokenD)\n        .opacity(0.0)\n        .waitUntilFinished()\n    .animation()\n        .on(tokenD)\n        .teleportTo(position)\n        .snapToGrid()\n        .waitUntilFinished()\n    .effect()\n        .file(\"jb2a.misty_step.02.blue\")\n        .atLocation(tokenD)\n        .randomRotation()\n        .scaleToObject(2)\n    .wait(1500)\n    .animation()\n        .on(tokenD)\n        .opacity(1.0)\n    .play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.0nao3mhIvaNzxmgx"}},"_id":"UXtbvgGdZUfyCl5M"}
{"name":"Sequencer-Rope","type":"script","author":"sW3E9DC6Z4EcEfdv","img":"icons/sundries/survival/rope-wrapped-yellow.webp","scope":"global","command":"const source = canvas.tokens.controlled[0];\n\nif(!source){\n    ui.notifications.error(\"You need to select a token for the rope to start on!\");\n    return;\n}\n\nconst target = Array.from(game.user.targets)?.[0]\n\nif(!target){\n    ui.notifications.error(\"You need to target a token for the rope to end on!\");\n    return;\n}\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/sequencer/samples/Bindings/rope.png\")\n        .attachTo(source)\n        .stretchTo(target, { attachTo: true })\n        .tilingTexture()\n        .template({ gridSize: 200 })\n        .scale(0.5)\n        .belowTokens()\n        .persist()\n    .play()","folder":null,"sort":0,"permission":{"default":0,"sW3E9DC6Z4EcEfdv":3},"flags":{"core":{"sourceId":"Macro.vutd41UisoqE0IW0"}},"_id":"X8PNqllfRRd3UeKS"}
{"name":"Sequencer-Spell-5e-Acid-Splash","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/acid/projectile-faceted-glob.webp","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Acid Splash spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!game.modules.get(\"animated-spell-effects-cartoon\")){\n    error = `You need to have the module \"Jack Kerouac's Animated Spell Effects: Cartoon\" installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = Array.from(args[0]?.failedSaves);\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else {\n\t\tif(token) targets.push(token);\n\t}\n}\n\nif(targets.length){\n    new Sequence()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[0])\n            .scale(0.3, 0.6)\n            .randomRotation()\n        .effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[1] ?? false)\n            .scale(0.3, 0.6)\n            .randomRotation()\n            .delay(300)\n            .playIf(targets.length === 2)\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.K2iB1URLuK9ZxYsD"}},"_id":"XYsBVWjipoQy5AK5"}
{"name":"Sequencer-Spell-5e-Faerie-Fire","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/light/orbs-firefly-hand-yellow.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Faerie Fire spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(!game.modules.get(\"advanced-macros\")?.active){\n    let installed = game.modules.get(\"advanced-macros\") && !game.modules.get(\"advanced-macros\").active ? \"enabled\" : \"installed\";\n    error = `You need to have Advanced Macros ${installed} to run this macro!`;\n}\n\nif(!game.modules.get(\"midi-qol\")?.active){\n    let installed = game.modules.get(\"midi-qol\") && !game.modules.get(\"midi-qol\").active ? \"enabled\" : \"installed\";\n    error = `You need to have MidiQOL ${installed} to run this macro!`;\n}\n\nif(typeof args === 'undefined' || args.length === 0){\n    error = `You can't run this macro from the hotbar! This is a callback macro. To use this, enable MidiQOL settings in \"Workflow\" -> \"Add macro to call on use\", then add this macro's name to the bottom of the Misty Step spell in the \"On Use Macro\" field.`;\n}\n\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet configSettings = game.settings.get(\"midi-qol\", \"ConfigSettings\");\nif(configSettings.autoTarget === \"none\"){\n    Hooks.once(\"createMeasuredTemplate\", runMacro);\n}else{\n    runMacro({_id: args[0].templateId});\n}\n\nasync function runMacro(template){\n\n    let templateC = canvas.templates.placeables.find(t => t.id === template._id);\n\n    if(templateC){\n\n        new Sequence()\n            .effect()\n                .file(\"jb2a.fireflies.few.01.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.few.02.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.many.01.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.many.02.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .waitUntilFinished()\n            .thenDo(() => {\n                try {\n                    canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [templateC._id]);\n                }catch(err){}\n            })\n            .play()\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.Ci4ls0VomA950hYI"}},"_id":"YY7ODwqauPETTSNK"}
{"name":"Sequencer-Spell-5e-Sword-Burst","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/skills/melee/blade-tips-double-blue.webp","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!game.modules.get(\"animated-spell-effects-cartoon\")){\n    error = `You need to have the module \"Jack Kerouac's Animated Spell Effects: Cartoon\" installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n// You can also run this directly on a selected token\nlet tokenD = typeof args !== \"undefined\" && args.length !== 0 ? canvas.tokens.get(args?.[0]?.tokenId) : token;\n\nif(tokenD) {\n    new Sequence()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/magic/magic_sphere_1token_SQUARE.webm\")\n            .atLocation(tokenD)\n            .scale(1.5)\n            .template({ gridSize: 100 })\n            .randomRotation()\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.dxxGCIwWWBa9RQvB"}},"_id":"etbc8j34ZkPRq5ag"}
{"name":"Sequencer-Spell-5e-Detect-Magic","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/symbols/runes-star-pentagon-blue.webp","scope":"global","command":"// Requires the JB2A patreon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Detect Magic spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\"))){\n    error = `You need to have JB2A's patreon only module installed to run this macro!`;\n}\n\nif(!game.modules.get(\"advanced-macros\")?.active){\n    let installed = game.modules.get(\"advanced-macros\") && !game.modules.get(\"advanced-macros\").active ? \"enabled\" : \"installed\";\n    error = `You need to have Advanced Macros ${installed} to run this macro!`;\n}\n\nif(!game.modules.get(\"midi-qol\")?.active){\n    let installed = game.modules.get(\"midi-qol\") && !game.modules.get(\"midi-qol\").active ? \"enabled\" : \"installed\";\n    error = `You need to have MidiQOL ${installed} to run this macro!`;\n}\n\nif(typeof args === 'undefined' || args.length === 0){\n    error = `You can't run this macro from the hotbar! This is a callback macro. To use this, enable MidiQOL settings in \"Workflow\" -> \"Add macro to call on use\", then add this macro's name to the bottom of the Detect Magic spell in the \"On Use Macro\" field.`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nconst tokenD = canvas.tokens.get(args[0].tokenId);\n\nlet magicalObjects = [];\n\nif(game.modules.get(\"tagger\")?.active){\n\n\tlet magicalSchools = [\"abjuration\", \"conjuration\", \"divination\", \"enchantment\", \"evocation\", \"illusion\", \"necromancy\", \"transmutation\"];\n\tlet magicalColors = [\"blue\", \"green\", \"pink\", \"purple\", \"red\", \"yellow\"];\n\n\tlet objects = Tagger.getByTag(\"magical\", { ignore: [tokenD] });\n\n\tmagicalObjects = objects.map(o => {\n\t\t\tlet distance = canvas.grid.measureDistance(tokenD, o);\n\t\t\treturn {\n\t\t\t\tdelay: distance * 55,\n\t\t\t\tdistance: distance,\n\t\t\t\tobj: o,\n\t\t\t\tschool: Tagger.getTags(o).find(t => magicalSchools.includes(t.toLowerCase())) || false,\n\t\t\t\tcolor: Tagger.getTags(o).find(t => magicalColors.includes(t.toLowerCase())) || \"blue\"\n\t\t\t}\n\t\t})\n\t\t.filter(o => o.distance <= 32.5)\n\n}\n\nlet sequence = new Sequence()\n\t.effect(\"jb2a.detect_magic.circle.blue\")\n\t\t.atLocation(tokenD)\n\t\t.belowTiles()\n\t\t.size(13.75 * canvas.grid.size)\n\nfor(let magical of magicalObjects){\n\n\tif(!magical.school) continue;\n\n\tnew Sequence()\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.intro.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.delay(magical.delay)\n\t\t\t.setMustache(magical)\n\t\t\t.waitUntilFinished(-800)\n\t\t\t.zIndex(0)\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.loop.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.setMustache(magical)\n\t\t\t.fadeOut(500)\n\t\t\t.waitUntilFinished(-800)\n\t\t\t.zIndex(1)\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.outro.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.setMustache(magical)\n\t\t\t.zIndex(0)\n\t\t.play()\n\n\tnew Sequence()\n\t\t.effect(\"jb2a.detect_magic.cone.blue\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.stretchTo(tokenD)\n\t\t\t.delay(magical.delay)\n\t\t.play()\n\n}\n\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.jRIsiWVlXN43CVjn"}},"_id":"nkOKwuiBmsfO7dtx"}
{"name":"Sequencer-VFX-Chain-Lightning-Complex","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/lightning/bolts-strike-salvo-blue.webp","scope":"global","command":"// Requires the JB2A module (free or patreon)\n// Select a token, then target a set of tokens in any order, and run this macro.\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\")?.active || game.modules.get(\"JB2A_DnD5e\")?.active)){\n    error = `You need to have JB2A installed and activated to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet origin = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nif(targets.indexOf(origin) > -1){\n    targets = targets.filter(t => t !== origin);\n}\n\n// Sort the targeted tokens in from the shortest distance to the longest distance\nlet tokenOrder = [];\nfor(let i = 0; i < targets.length; i++){\n    let potential_targets = targets.filter(item => tokenOrder.indexOf(item) === -1);\n    let from = tokenOrder[tokenOrder.length-1] ?? origin;\n    let closest = potential_targets.reduce((a, b) => findClosestTo(from, a, b));\n    tokenOrder.push(closest);\n}\n\nlet [firstTarget] = tokenOrder.splice(0, 1); // This removes the first target from the list, and makes it the first target\n\nlet sequence = new Sequence(); // Create a new sequence\n\nsequence.effect()\n    .file(\"jb2a.chain_lightning.primary.blue\")\n    .atLocation(origin) // Going from origin\n    .stretchTo(firstTarget) // To the current loop's target\n    .wait(600)\n\n// then it jumps from the first target, to the next target, and so on\norigin = firstTarget;\n\nfor(let target of tokenOrder){\n    sequence.effect()\n        .file(\"jb2a.chain_lightning.secondary.blue\")\n        .atLocation(origin) // Going from origin\n        .stretchTo(target) // To the current loop's target\n    .effect()\n        .file(\"jb2a.static_electricity.02.blue02\")\n        .atLocation(target) // Static on the target\n        .scaleToObject(1.5) // Scale so it fits the target\n        .randomRotation() // Randomly rotate the effect so it's not the same for each token\n    .wait(200) // Slight delay between each arc\n\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()\n\n// This function finds the closest token from a given origin token\nfunction findClosestTo(from, a, b){\n    let a_dist = canvas.grid.measureDistance(from, a);\n    let b_dist = canvas.grid.measureDistance(from, b);\n    // If the distances are the same, randomly pick one of the two\n    if(a_dist === b_dist){\n        return Math.random() > 0.5 ? a : b;\n    }\n    return a_dist < b_dist ? a : b;\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.1aKkG9IYsSN0M9OK"}},"_id":"yQoeRiQ8VaPkXHqH"}
